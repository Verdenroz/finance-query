openapi: 3.0.3
info:
  title: Finance Query v2
  version: 2.0.0
  description: |
    REST API for fetching financial data from Yahoo Finance.
    Provides real-time quotes, historical data, news, options, and more.
  contact:
    name: Finance Query
    url: https://github.com/verdenroz/finance-query

servers:
  - url: http://localhost:8000
    description: Local development server
  - url: http://localhost:8000/v2
    description: API v2

tags:
  - name: Health
    description: Health check and status endpoints
  - name: Market
    description: Market hours and status
  - name: Quotes
    description: Stock quote and pricing data
  - name: Charts
    description: Historical price data and candlesticks
  - name: Indicators
    description: Technical analysis indicators
  - name: News
    description: Financial news articles
  - name: Options
    description: Options chains and contracts
  - name: Analysis
    description: Analyst recommendations and estimates
  - name: Financials
    description: Company financials and timeseries data
  - name: Holders
    description: Institutional and insider holdings
  - name: Movers
    description: Market movers (gainers, losers, actives)
  - name: Search
    description: Symbol and company search

paths:
  /health:
    get:
      tags: [Health]
      summary: Health check
      description: Check API health status
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  version:
                    type: string
                    example: 2.0.0

  /ping:
    get:
      tags: [Health]
      summary: Ping endpoint
      description: Simple ping-pong endpoint
      responses:
        '200':
          description: Pong response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: pong

  /v2/hours:
    get:
      tags: [Market]
      summary: Get market hours
      description: |
        Fetch current market hours and status for a specific region.
        Returns market open/close times, current status, and timezone information.
      parameters:
        - name: region
          in: query
          schema:
            $ref: '#/components/schemas/Region'
          description: Market region code (defaults to US if not specified)
      responses:
        '200':
          description: Market hours data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HoursResponse'
              example:
                markets:
                  - id: us
                    name: U.S. markets
                    status: closed
                    message: U.S. markets closed
                    open: "2025-12-26T14:30:00Z"
                    close: "2025-12-26T21:00:00Z"
                    time: "2025-12-27T01:06:14Z"
                    timezone: America/New_York
                    timezoneShort: EST
                    gmtOffset: -18000
                    dst: false
        '500':
          $ref: '#/components/responses/InternalError'

  /v2/quote/{symbol}:
    get:
      tags: [Quotes]
      summary: Get quote for a symbol
      description: Fetch detailed quote data for a single stock symbol
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          example: AAPL
        - name: logo
          in: query
          schema:
            type: boolean
            default: false
          description: Include company logo URL
        - $ref: '#/components/parameters/Format'
      responses:
        '200':
          description: Quote data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quote'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /v2/quotes:
    get:
      tags: [Quotes]
      summary: Get quotes for multiple symbols
      description: |
        Fetch quote data for multiple stock symbols in a single batch request.
      parameters:
        - name: symbols
          in: query
          required: true
          schema:
            type: string
          description: Comma-separated list of symbols
          example: AAPL,MSFT,GOOGL
        - name: logo
          in: query
          schema:
            type: boolean
            default: false
          description: Include company logo URLs
        - $ref: '#/components/parameters/Format'
      responses:
        '200':
          description: Batch quotes response with successful quotes and any errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchQuotesResponse'
              example:
                quotes:
                  AAPL:
                    symbol: AAPL
                    shortName: Apple Inc.
                    regularMarketPrice: 182.52
                  MSFT:
                    symbol: MSFT
                    shortName: Microsoft Corporation
                    regularMarketPrice: 378.91
                errors:
                  INVALID: "Symbol not found in response"
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /v2/recommendations/{symbol}:
    get:
      tags: [Quotes]
      summary: Get similar stock recommendations
      description: Get recommended similar stocks for a given symbol
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          example: AAPL
        - name: limit
          in: query
          schema:
            type: integer
            default: 5
          description: Maximum number of recommendations
      responses:
        '200':
          description: Recommendations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Recommendation'

  /v2/chart/{symbol}:
    get:
      tags: [Charts]
      summary: Get historical chart data
      description: Fetch OHLCV candlestick data for a symbol
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          example: AAPL
        - name: interval
          in: query
          schema:
            type: string
            enum: [1m, 2m, 5m, 15m, 30m, 60m, 90m, 1h, 1d, 5d, 1wk, 1mo, 3mo]
            default: 1d
          description: Chart interval
        - name: range
          in: query
          schema:
            type: string
            enum: [1d, 5d, 1mo, 3mo, 6mo, 1y, 2y, 5y, 10y, ytd, max]
            default: 1mo
          description: Time range
      responses:
        '200':
          description: Chart data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Chart'

  /v2/indicators/{symbol}:
    get:
      tags: [Indicators]
      summary: Get technical indicators
      description: Calculate technical analysis indicators from chart data
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          example: AAPL
        - name: interval
          in: query
          schema:
            type: string
            default: 1d
        - name: range
          in: query
          schema:
            type: string
            default: 1mo
      responses:
        '200':
          description: Technical indicators
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IndicatorsSummary'

  /v2/indices:
    get:
      tags: [Quotes]
      summary: Get world market indices
      description: |
        Fetch quotes for world market indices, optionally filtered by region.
      parameters:
        - name: region
          in: query
          required: false
          schema:
            type: string
            enum: [americas, europe, asia-pacific, middle-east-africa, currencies]
          description: Filter by region (returns all if not specified)
        - $ref: '#/components/parameters/Format'
      responses:
        '200':
          description: Batch quotes response for world indices
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchQuotesResponse'
        '500':
          $ref: '#/components/responses/InternalError'

  /v2/news:
    get:
      tags: [News]
      summary: Get general market news
      description: Fetch general financial market news
      parameters:
        - name: count
          in: query
          schema:
            type: integer
            default: 10
          description: Number of articles to return
      responses:
        '200':
          description: News articles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsResponse'

  /v2/news/{symbol}:
    get:
      tags: [News]
      summary: Get news for a symbol
      description: Fetch news articles related to a specific stock
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          example: AAPL
        - name: count
          in: query
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Symbol news
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsResponse'

  /v2/options/{symbol}:
    get:
      tags: [Options]
      summary: Get options chain
      description: Fetch options contracts for a symbol
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          example: AAPL
        - name: date
          in: query
          schema:
            type: integer
          description: Expiration date (Unix timestamp)
      responses:
        '200':
          description: Options chain
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OptionsResponse'

  /v2/financials/{symbol}/{statement}:
    get:
      tags: [Financials]
      summary: Get financial statements
      description: |
        Fetch financial statement data (income statement, balance sheet, or cash flow) for a symbol.
        Returns historical data with metrics organized by date.
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          description: Stock symbol
          example: AAPL
        - name: statement
          in: path
          required: true
          schema:
            type: string
            enum: [income, balance, cashflow]
          description: Type of financial statement
          example: income
        - name: frequency
          in: query
          schema:
            type: string
            enum: [annual, quarterly]
            default: annual
          description: Data frequency (annual or quarterly)
      responses:
        '200':
          description: Financial statement data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FinancialStatement'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Symbol not found or no data available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /v2/quote-type/{symbol}:
    get:
      tags: [Quotes]
      summary: Get quote type
      description: Get the type of quote (EQUITY, ETF, etc.)
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          example: AAPL
      responses:
        '200':
          description: Quote type
          content:
            application/json:
              schema:
                type: object

  /v2/holders/{symbol}/{type}:
    get:
      tags: [Holders]
      summary: Get holder data
      description: |
        Fetch holder data for a symbol by type.
        Available types:
        - major: Major institutional holders
        - institutional: Institutional holder positions
        - mutualfund: Mutual fund holder positions
        - insider-transactions: Insider trading transactions
        - insider-purchases: Insider purchase history
        - insider-roster: List of company insiders
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          description: Stock symbol
          example: AAPL
        - name: type
          in: path
          required: true
          schema:
            type: string
            enum: [major, institutional, mutualfund, insider-transactions, insider-purchases, insider-roster]
          description: Type of holder data
          example: major
      responses:
        '200':
          description: Holder data
          content:
            application/json:
              schema:
                type: object
        '400':
          $ref: '#/components/responses/BadRequest'

  /v2/analysis/{symbol}/{type}:
    get:
      tags: [Analysis]
      summary: Get analysis data
      description: |
        Fetch analysis data for a symbol by type.
        Available types:
        - recommendations: Analyst recommendation trends over time
        - upgrades-downgrades: Analyst rating changes
        - earnings-estimate: Analyst earnings estimates
        - earnings-history: Historical earnings data
      parameters:
        - name: symbol
          in: path
          required: true
          schema:
            type: string
          description: Stock symbol
          example: AAPL
        - name: type
          in: path
          required: true
          schema:
            type: string
            enum: [recommendations, upgrades-downgrades, earnings-estimate, earnings-history]
          description: Type of analysis data
          example: recommendations
      responses:
        '200':
          description: Analysis data
          content:
            application/json:
              schema:
                type: object
        '400':
          $ref: '#/components/responses/BadRequest'

  /v2/movers/{type}:
    get:
      tags: [Movers]
      summary: Get market movers
      description: |
        Fetch market movers by type.
        Available types:
        - gainers: Top gaining stocks
        - losers: Top losing stocks
        - actives: Most active stocks by volume
      parameters:
        - name: type
          in: path
          required: true
          schema:
            type: string
            enum: [gainers, losers, actives]
          description: Type of market movers
          example: gainers
        - name: count
          in: query
          schema:
            type: integer
            default: 10
          description: Number of results to return
      responses:
        '200':
          description: Market movers
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MoversResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /v2/search:
    get:
      tags: [Search]
      summary: Search symbols
      description: Search for stock symbols and companies
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Search query
          example: Apple
        - name: hits
          in: query
          schema:
            type: integer
            default: 6
          description: Maximum results
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'

  /v2/earnings-transcript:
    get:
      tags: [Analysis]
      summary: Get earnings transcript
      description: Fetch earnings call transcript
      parameters:
        - name: event_id
          in: query
          required: true
          schema:
            type: string
          description: Event ID
        - name: company_id
          in: query
          required: true
          schema:
            type: string
          description: Company ID
      responses:
        '200':
          description: Earnings transcript
          content:
            application/json:
              schema:
                type: object

components:
  parameters:
    Format:
      name: format
      in: query
      schema:
        type: string
        enum: [raw, pretty, both]
        default: raw
      description: |
        Controls how fields are displayed

  schemas:
    Quote:
      type: object
      description: Stock quote data
      properties:
        symbol:
          type: string
          example: AAPL
        regularMarketPrice:
          type: number
          format: double
          example: 182.52
        regularMarketChange:
          type: number
          format: double
        regularMarketChangePercent:
          type: number
          format: double
        regularMarketVolume:
          type: integer
          format: int64
        marketCap:
          type: integer
          format: int64
        fiftyTwoWeekHigh:
          type: number
          format: double
        fiftyTwoWeekLow:
          type: number
          format: double
        logoUrl:
          type: string
          nullable: true
        companyLogoUrl:
          type: string
          nullable: true

    BatchQuotesResponse:
      type: object
      description: Response from batch quotes endpoint with successful quotes and errors
      properties:
        quotes:
          type: object
          description: Successfully fetched quotes, keyed by symbol
          additionalProperties:
            $ref: '#/components/schemas/Quote'
          example:
            AAPL:
              symbol: AAPL
              shortName: Apple Inc.
              regularMarketPrice: 182.52
            MSFT:
              symbol: MSFT
              shortName: Microsoft Corporation
              regularMarketPrice: 378.91
        errors:
          type: object
          description: Symbols that failed to fetch, with error messages
          additionalProperties:
            type: string
          example:
            INVALID: "Symbol not found in response"

    Chart:
      type: object
      properties:
        symbol:
          type: string
        meta:
          $ref: '#/components/schemas/ChartMeta'
        candles:
          type: array
          items:
            $ref: '#/components/schemas/Candle'
        interval:
          type: string
        range:
          type: string

    ChartMeta:
      type: object
      properties:
        currency:
          type: string
        symbol:
          type: string
        exchangeName:
          type: string
        instrumentType:
          type: string
        firstTradeDate:
          type: integer
        regularMarketTime:
          type: integer
        gmtoffset:
          type: integer
        timezone:
          type: string
        exchangeTimezoneName:
          type: string
        regularMarketPrice:
          type: number
        chartPreviousClose:
          type: number
        dataGranularity:
          type: string
        range:
          type: string

    Candle:
      type: object
      properties:
        timestamp:
          type: integer
          format: int64
        open:
          type: number
          format: double
        high:
          type: number
          format: double
        low:
          type: number
          format: double
        close:
          type: number
          format: double
        volume:
          type: integer
          format: int64
        adjClose:
          type: number
          format: double
          nullable: true

    IndicatorsSummary:
      type: object
      description: Technical analysis indicators
      properties:
        sma_10:
          type: number
          nullable: true
        sma_20:
          type: number
          nullable: true
        sma_50:
          type: number
          nullable: true
        ema_20:
          type: number
          nullable: true
        rsi_14:
          type: number
          nullable: true
        macd:
          $ref: '#/components/schemas/MacdData'
        bollinger_bands:
          $ref: '#/components/schemas/BollingerBandsData'

    MacdData:
      type: object
      properties:
        macd:
          type: number
          nullable: true
        signal:
          type: number
          nullable: true
        histogram:
          type: number
          nullable: true

    BollingerBandsData:
      type: object
      properties:
        upper:
          type: number
          nullable: true
        middle:
          type: number
          nullable: true
        lower:
          type: number
          nullable: true

    NewsResponse:
      type: object
      properties:
        count:
          type: integer
        news:
          type: array
          items:
            $ref: '#/components/schemas/NewsArticle'

    NewsArticle:
      type: object
      properties:
        uuid:
          type: string
        title:
          type: string
        publisher:
          type: string
        link:
          type: string
        providerPublishTime:
          type: integer
        type:
          type: string
        thumbnail:
          $ref: '#/components/schemas/NewsThumbnail'

    NewsThumbnail:
      type: object
      properties:
        resolutions:
          type: array
          items:
            type: object
            properties:
              url:
                type: string
              width:
                type: integer
              height:
                type: integer

    OptionsResponse:
      type: object
      properties:
        expirationDates:
          type: array
          items:
            type: integer
        strikes:
          type: array
          items:
            type: number
        hasMiniOptions:
          type: boolean
        options:
          type: array
          items:
            $ref: '#/components/schemas/OptionChain'

    OptionChain:
      type: object
      properties:
        expirationDate:
          type: integer
        hasMiniOptions:
          type: boolean
        calls:
          type: array
          items:
            $ref: '#/components/schemas/OptionContract'
        puts:
          type: array
          items:
            $ref: '#/components/schemas/OptionContract'

    OptionContract:
      type: object
      properties:
        contractSymbol:
          type: string
        strike:
          type: number
        currency:
          type: string
        lastPrice:
          type: number
        change:
          type: number
        percentChange:
          type: number
        volume:
          type: integer
        openInterest:
          type: integer
        bid:
          type: number
        ask:
          type: number
        contractSize:
          type: string
        expiration:
          type: integer
        lastTradeDate:
          type: integer
        impliedVolatility:
          type: number
        inTheMoney:
          type: boolean

    Recommendation:
      type: object
      properties:
        symbol:
          type: string
        recommendations:
          type: array
          items:
            $ref: '#/components/schemas/SimilarSymbol'

    SimilarSymbol:
      type: object
      properties:
        symbol:
          type: string
        recommendationPercent:
          type: number

    FinancialStatement:
      type: object
      description: Financial statement data organized by metric and date
      properties:
        symbol:
          type: string
          description: Stock symbol
          example: AAPL
        statementType:
          type: string
          description: Type of statement (income, balance, cashflow)
          example: income
        frequency:
          type: string
          description: Data frequency (annual or quarterly)
          example: annual
        statement:
          type: object
          description: Financial metrics mapped to date-value pairs
          additionalProperties:
            type: object
            additionalProperties:
              type: number
          example:
            TotalRevenue:
              "2024-09-30": 391035000000
              "2023-09-30": 383285000000
            NetIncome:
              "2024-09-30": 100913000000
              "2023-09-30": 96995000000

    MoversResponse:
      type: object
      properties:
        count:
          type: integer
        quotes:
          type: array
          items:
            $ref: '#/components/schemas/MoverQuote'

    MoverQuote:
      type: object
      properties:
        symbol:
          type: string
        regularMarketPrice:
          type: number
        regularMarketChange:
          type: number
        regularMarketChangePercent:
          type: number
        regularMarketVolume:
          type: integer

    SearchResponse:
      type: object
      properties:
        count:
          type: integer
        quotes:
          type: array
          items:
            $ref: '#/components/schemas/SearchQuote'

    SearchQuote:
      type: object
      properties:
        symbol:
          type: string
        shortname:
          type: string
        longname:
          type: string
        exchDisp:
          type: string
        typeDisp:
          type: string
        exchange:
          type: string
        quoteType:
          type: string
        isYahooFinance:
          type: boolean

    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string

    Region:
      type: string
      description: Market region code
      enum:
        - AR  # Argentina
        - AU  # Australia
        - BR  # Brazil
        - CA  # Canada
        - CN  # China
        - DK  # Denmark
        - FI  # Finland
        - FR  # France
        - DE  # Germany
        - GR  # Greece
        - HK  # Hong Kong
        - IN  # India
        - IL  # Israel
        - IT  # Italy
        - JP  # Japan
        - KR  # Korea
        - MY  # Malaysia
        - MX  # Mexico
        - NZ  # New Zealand
        - NO  # Norway
        - PT  # Portugal
        - RU  # Russia
        - SG  # Singapore
        - ES  # Spain
        - SE  # Sweden
        - TW  # Taiwan
        - TH  # Thailand
        - TR  # Turkey
        - GB  # United Kingdom
        - US  # United States
        - VN  # Vietnam
      default: US

    HoursResponse:
      type: object
      description: Market hours response containing market time data
      properties:
        markets:
          type: array
          items:
            $ref: '#/components/schemas/MarketTime'

    MarketTime:
      type: object
      description: Market time information for a specific region
      properties:
        id:
          type: string
          description: Market identifier (e.g., "us", "jp", "gb")
          example: us
        name:
          type: string
          description: Human-readable market name
          example: U.S. markets
        status:
          type: string
          description: Current market status (e.g., "open", "closed")
          example: closed
        message:
          type: string
          description: Status message
          example: U.S. markets closed
        open:
          type: string
          format: date-time
          description: Market open time (ISO 8601)
          example: "2025-12-26T14:30:00Z"
        close:
          type: string
          format: date-time
          description: Market close time (ISO 8601)
          example: "2025-12-26T21:00:00Z"
        time:
          type: string
          format: date-time
          description: Current time (ISO 8601)
          example: "2025-12-27T01:06:14Z"
        timezone:
          type: string
          description: Timezone name (IANA format)
          example: America/New_York
        timezoneShort:
          type: string
          description: Short timezone name
          example: EST
        gmtOffset:
          type: integer
          description: GMT offset in seconds
          example: -18000
        dst:
          type: boolean
          description: Whether daylight saving time is in effect
          example: false

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
